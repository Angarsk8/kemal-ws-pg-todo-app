$(document).ready(function(){$(".add-task").on("click",function(b){b.preventDefault(),a(),$("#task-form").attr("note-action","CREATE").find("#submit-button").text("Create"),$("#input-form").modal("show")}),$("#input-form").on("shown.bs.modal",function(){$("#note-title").focus()}),$("#task-form").on("submit",function(a){a.preventDefault();var b=$("#task-form").attr("note-action"),c=$("[name=note_title]").val().trim(),d=$("[name=note_content]").val().trim(),e=parseInt($("#task-form").attr("note-id"));if(!c||!d)return!1;var f="CREATE"==b?{title:c,content:d,type:b}:{id:e,title:c,content:d,type:b},g=stringify(f);ws.send(g),$("#input-form").modal("hide")}),$("[name=note_content]").keypress(function(a){13==a.which&&$("#task-form").submit()}),$(".panels-wrapper").on("keypress","[contenteditable]",function(a){13==a.which&&$(this).blur()}),$(".panels-wrapper").on("click",".closing-icon, .delete-button",function(a){a.preventDefault();var b=parseInt($(this).parents(".note-panel").attr("note-id")),c=stringify({id:b,type:"DELETE"});$(this).parents(".note-panel").addClass("animated fadeOut"),setTimeout(function(){ws.send(c)},1e3)}),$(".panels-wrapper").on("blur","[contenteditable]",function(){var a=$(this).parents(".note-panel"),b=parseInt(a.attr("note-id")),c=a.find(".note-title-text").text(),d=a.find(".note-content").text(),e=stringify({id:b,title:c,content:d,type:"UPDATE"});$("[contenteditable]").each(function(){return $(this).attr("contenteditable","false")}),ws.send(e)}),$(".panels-wrapper").on("click",".edit-button",function(b){b.preventDefault(),a();var c=$(this).parents(".note-panel"),d=c.attr("note-id"),e=c.find(".note-title-text").text(),f=c.find(".note-content").text();$("[name=note_title]").val(e),$("[name=note_content]").val(f),$("#task-form").attr("note-action","UPDATE").attr("note-id",d).find("#submit-button").text("Update"),$("#input-form").modal("show")});var a=function(){$("#input-form").modal("hide"),$('input[name="note_title"]').val("").removeClass("error"),$('textarea[name="note_content"]').val("").removeClass("error"),$("label.error").remove()};$("#task-form").validate({rules:{note_title:{required:!0},note_content:{required:!0}},messages:{note_title:{required:"Please, enter a title for your note!"},note_content:{required:"Please, enter a description for your note!"}}})});var _location=location,hostname=_location.hostname,port=_location.port,parse=JSON.parse,stringify=JSON.stringify;ws=new WebSocket("wss://"+hostname+":"+port+"/notes"),ws.onmessage=function(a){var b=parse(a.data).map(function(a){return parse(a)}),c=$(".note-panel").length,d=b.length,e=c==d||c>d?"":"animated fadeIn",f=b.map(function(a,c){return noteHTML(a,setAnimation(b,c,e))});$(".panels-wrapper").html(f)},ws.onclose=function(a){console.log("Connection Closed: "+a.reason)},ws.onerror=function(a){console.log("Socket Error: "+a.data)};var setAnimation=function(a,b,c){return a.length-1===b?c:""};setInterval(function(){ws.send(stringify({type:"PING"}))},1e4);var noteHTML=function(a,b){return'<div class="panel panel-default note-panel '+b+'" note-id="'+a.id+'">\n    <div class="panel-heading">\n      <h3 class="panel-title custom-typo-title note-title">\n        <span contenteditable="true" class="text-info note-title-text"  >'+a.title+'</span>\n        <span id="updated-text">\n          '+(a.created_at!==a.updated_at?"(updated)":"")+'\n        </span>\n        <span class="pull-right closing-icon">x</span>\n      </h3>\n    </div>\n    <div class="panel-body">\n      <div contenteditable="true" class="custom-typo text-muted note-content">'+a.content+'</div>\n      <div class="timestamps">\n        <small class="text-success"><span class="hidden-xs">Created at</span> '+a.created_at+'</small>\n        | <small class="text-warning"><span class="hidden-xs">Update at</span> '+a.updated_at+'</small>\n      </div>\n      <div class="buttons-block">\n        <button type="button" class="delete-button btn btn-danger btn-sm app-button">\n          Delete\n        </button>\n        <button type="button" class="edit-button btn btn-warning btn-sm app-button">\n          Edit\n        </button>\n      </div>\n    </div>\n  </div'};